import { Meta, Canvas, Controls, Story, ArgTypes } from '@storybook/addon-docs/blocks';
import ModalMeta, * as ModalStories from '../components/ui/Modal/Modal.stories';
import { Modal } from '../components/ui/Modal';

<Meta title="Documentation/Base UI/Modal" />

# Modal Component

The Modal component displays content in a layer above the page. It's designed for focused interactions, confirmations, forms, and detailed information that requires user attention.

## Overview

Modals (also known as dialogs) are overlays that require user interaction before returning to the main application. They're useful for critical alerts, complex forms, media galleries, and any content that benefits from focused attention.

<Canvas of={ModalStories.Default} />

## Props

<ArgTypes of={Modal} />

## Detailed Props Documentation

### `isOpen`
**Type:** `boolean`  
**Required**

Controls the modal visibility:

```tsx
const [isOpen, setIsOpen] = useState(false);

<Modal isOpen={isOpen} onClose={() => setIsOpen(false)}>
  Content
</Modal>
```

### `onClose`
**Type:** `() => void`  
**Required**

Callback when modal should close:

```tsx
<Modal 
  isOpen={isOpen}
  onClose={() => {
    // Cleanup or validation before closing
    if (canClose) {
      setIsOpen(false);
    }
  }}
>
  Content
</Modal>
```

### `title`
**Type:** `string`  
**Default:** `undefined`

Modal header title:

```tsx
<Modal title="Confirm Action" isOpen={isOpen} onClose={onClose}>
  Are you sure?
</Modal>
```

### `size`
**Type:** `'sm' | 'md' | 'lg' | 'xl' | 'full'`  
**Default:** `'md'`

Controls modal width:

- **sm**: 400px max-width
- **md**: 500px max-width (default)
- **lg**: 800px max-width
- **xl**: 1140px max-width
- **full**: Full screen

<Canvas of={ModalStories.Sizes} />

### `closeOnOverlayClick`
**Type:** `boolean`  
**Default:** `true`

Close modal when clicking outside:

```tsx
<Modal 
  closeOnOverlayClick={false}
  isOpen={isOpen}
  onClose={onClose}
>
  Must use close button
</Modal>
```

### `closeOnEsc`
**Type:** `boolean`  
**Default:** `true`

Close modal on Escape key:

```tsx
<Modal 
  closeOnEsc={false}
  isOpen={isOpen}
  onClose={onClose}
>
  Cannot close with Escape
</Modal>
```

### `showCloseButton`
**Type:** `boolean`  
**Default:** `true`

Show/hide the close button:

```tsx
<Modal 
  showCloseButton={false}
  isOpen={isOpen}
  onClose={onClose}
>
  No close button
</Modal>
```

### `footer`
**Type:** `React.ReactNode`  
**Default:** `undefined`

Custom footer content:

```tsx
<Modal
  footer={
    <div className="flex gap-2 justify-end">
      <Button variant="ghost" onClick={onClose}>
        Cancel
      </Button>
      <Button variant="primary" onClick={handleSave}>
        Save
      </Button>
    </div>
  }
>
  Content
</Modal>
```

### `className`
**Type:** `string`  
**Default:** `''`

Additional CSS classes for the modal content.

### `overlayClassName`
**Type:** `string`  
**Default:** `''`

Additional CSS classes for the overlay.

### `preventScroll`
**Type:** `boolean`  
**Default:** `true`

Prevent body scroll when modal is open.

### `animate`
**Type:** `boolean`  
**Default:** `true`

Enable enter/exit animations.

## Usage Examples

### Basic Modal

```tsx
import { Modal } from '@/components/ui/Modal';
import { useState } from 'react';

function BasicModal() {
  const [isOpen, setIsOpen] = useState(false);
  
  return (
    <>
      <button onClick={() => setIsOpen(true)}>
        Open Modal
      </button>
      
      <Modal
        isOpen={isOpen}
        onClose={() => setIsOpen(false)}
        title="Welcome"
      >
        <p>This is a basic modal example.</p>
      </Modal>
    </>
  );
}
```

### Confirmation Dialog

```tsx
function ConfirmDialog({ onConfirm }) {
  const [isOpen, setIsOpen] = useState(false);
  
  const handleConfirm = () => {
    onConfirm();
    setIsOpen(false);
  };
  
  return (
    <>
      <Button variant="error" onClick={() => setIsOpen(true)}>
        Delete Item
      </Button>
      
      <Modal
        isOpen={isOpen}
        onClose={() => setIsOpen(false)}
        title="Confirm Deletion"
        size="sm"
        footer={
          <>
            <Button variant="ghost" onClick={() => setIsOpen(false)}>
              Cancel
            </Button>
            <Button variant="error" onClick={handleConfirm}>
              Delete
            </Button>
          </>
        }
      >
        <Alert variant="warning" className="mb-4">
          This action cannot be undone
        </Alert>
        <p>Are you sure you want to delete this item?</p>
      </Modal>
    </>
  );
}
```

### Form Modal

```tsx
function FormModal() {
  const [isOpen, setIsOpen] = useState(false);
  const [formData, setFormData] = useState({
    name: '',
    email: ''
  });
  
  const handleSubmit = (e) => {
    e.preventDefault();
    // Handle form submission
    setIsOpen(false);
  };
  
  return (
    <Modal
      isOpen={isOpen}
      onClose={() => setIsOpen(false)}
      title="User Registration"
      size="md"
    >
      <form onSubmit={handleSubmit}>
        <div className="space-y-4">
          <Input
            label="Name"
            value={formData.name}
            onChange={(e) => setFormData({...formData, name: e.target.value})}
            required
          />
          
          <Input
            label="Email"
            type="email"
            value={formData.email}
            onChange={(e) => setFormData({...formData, email: e.target.value})}
            required
          />
        </div>
        
        <div className="flex gap-2 justify-end mt-6">
          <Button type="button" variant="ghost" onClick={() => setIsOpen(false)}>
            Cancel
          </Button>
          <Button type="submit" variant="primary">
            Register
          </Button>
        </div>
      </form>
    </Modal>
  );
}
```

### Image Gallery Modal

```tsx
function ImageGalleryModal({ images }) {
  const [isOpen, setIsOpen] = useState(false);
  const [currentImage, setCurrentImage] = useState(0);
  
  return (
    <Modal
      isOpen={isOpen}
      onClose={() => setIsOpen(false)}
      size="xl"
      title={`Image ${currentImage + 1} of ${images.length}`}
    >
      <div className="relative">
        <img 
          src={images[currentImage]} 
          alt=""
          className="w-full h-auto"
        />
        
        <button
          onClick={() => setCurrentImage(Math.max(0, currentImage - 1))}
          className="absolute left-4 top-1/2 -translate-y-1/2"
          disabled={currentImage === 0}
        >
          <ChevronLeft />
        </button>
        
        <button
          onClick={() => setCurrentImage(Math.min(images.length - 1, currentImage + 1))}
          className="absolute right-4 top-1/2 -translate-y-1/2"
          disabled={currentImage === images.length - 1}
        >
          <ChevronRight />
        </button>
      </div>
    </Modal>
  );
}
```

### Game Details Modal

```tsx
function GameDetailsModal({ game, isOpen, onClose }) {
  return (
    <Modal
      isOpen={isOpen}
      onClose={onClose}
      title={game.title}
      size="lg"
      footer={
        <Button variant="primary" fullWidth onClick={() => playGame(game.id)}>
          Play Now
        </Button>
      }
    >
      <div className="space-y-4">
        <img 
          src={game.thumbnail} 
          alt={game.title}
          className="w-full h-48 object-cover rounded"
        />
        
        <div className="flex gap-2">
          <Badge variant="info">{game.type}</Badge>
          <Badge variant="secondary">{game.provider}</Badge>
          {game.isNew && <Badge variant="new">NEW</Badge>}
        </div>
        
        <p className="text-secondary">{game.description}</p>
        
        <div className="grid grid-cols-2 gap-4">
          <div>
            <span className="text-sm text-secondary">RTP</span>
            <p className="font-semibold">{game.rtp}%</p>
          </div>
          <div>
            <span className="text-sm text-secondary">Max Win</span>
            <p className="font-semibold">{game.maxWin}x</p>
          </div>
        </div>
      </div>
    </Modal>
  );
}
```

### Nested Modals

```tsx
function NestedModals() {
  const [parentOpen, setParentOpen] = useState(false);
  const [childOpen, setChildOpen] = useState(false);
  
  return (
    <>
      <Modal
        isOpen={parentOpen}
        onClose={() => setParentOpen(false)}
        title="Parent Modal"
      >
        <p>This is the parent modal.</p>
        <Button onClick={() => setChildOpen(true)}>
          Open Child Modal
        </Button>
        
        <Modal
          isOpen={childOpen}
          onClose={() => setChildOpen(false)}
          title="Child Modal"
          size="sm"
        >
          <p>This is a nested modal.</p>
        </Modal>
      </Modal>
    </>
  );
}
```

## Accessibility

The Modal component is fully accessible:

- **Focus management**: Focus trapped within modal
- **ARIA attributes**: Proper roles and labels
- **Keyboard navigation**: Tab through focusable elements
- **Screen readers**: Announced when opened
- **Escape key**: Closes modal by default

### Keyboard Support

- **Tab**: Navigate through modal elements
- **Shift+Tab**: Navigate backwards
- **Escape**: Close modal (if enabled)
- **Enter**: Submit forms/confirm actions

### ARIA Implementation

```tsx
<div
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title"
  aria-describedby="modal-description"
>
  <h2 id="modal-title">Modal Title</h2>
  <div id="modal-description">Modal content</div>
</div>
```

## Design Tokens

```css
/* Sizes */
--modal-width-sm: 400px;
--modal-width-md: 500px;
--modal-width-lg: 800px;
--modal-width-xl: 1140px;

/* Spacing */
--modal-padding: 1.5rem;
--modal-header-padding: 1.5rem;
--modal-footer-padding: 1.5rem;

/* Z-index */
--modal-overlay-z: 9998;
--modal-content-z: 9999;

/* Animation */
--modal-transition: all 0.3s ease;
--modal-overlay-opacity: 0.5;
```

## Best Practices

### Do's ✅

- Use for focused tasks requiring user input
- Provide clear titles and actions
- Include cancel/close options
- Keep content concise
- Test keyboard navigation
- Handle escape key appropriately

### Don'ts ❌

- Don't nest multiple modals (avoid if possible)
- Don't use for simple confirmations (use native confirm)
- Don't auto-open on page load
- Don't make modals too large
- Don't forget loading states for async actions
- Don't trap users without escape options

## Responsive Design

Modals adapt to screen sizes:

- **Mobile**: Full screen with proper padding
- **Tablet**: Centered with margins
- **Desktop**: Specified sizes respected

<Canvas of={ModalStories.Mobile} />

## Theme Support

Full dark and light theme support:

<Canvas of={ModalStories.DarkMode} />
<Canvas of={ModalStories.LightMode} />

## Common Patterns

### Loading State

```tsx
function LoadingModal({ isLoading }) {
  return (
    <Modal
      isOpen={isLoading}
      onClose={() => {}}
      closeOnOverlayClick={false}
      closeOnEsc={false}
      showCloseButton={false}
      size="sm"
    >
      <div className="text-center py-8">
        <Loader className="animate-spin mx-auto mb-4" />
        <p>Processing...</p>
      </div>
    </Modal>
  );
}
```

### Wizard Modal

```tsx
function WizardModal() {
  const [step, setStep] = useState(1);
  const totalSteps = 3;
  
  return (
    <Modal
      isOpen={true}
      onClose={onClose}
      title={`Step ${step} of ${totalSteps}`}
      footer={
        <>
          <Button 
            variant="ghost" 
            onClick={() => setStep(Math.max(1, step - 1))}
            disabled={step === 1}
          >
            Previous
          </Button>
          <Button
            variant="primary"
            onClick={() => setStep(Math.min(totalSteps, step + 1))}
          >
            {step === totalSteps ? 'Finish' : 'Next'}
          </Button>
        </>
      }
    >
      {/* Step content based on current step */}
    </Modal>
  );
}
```

## Performance

- Portal rendering for better z-index management
- Lazy content rendering when closed
- Optimized animations with CSS transforms
- Focus trap prevents unnecessary renders

## Migration Guide

From other modal libraries:

1. Replace modal wrapper with `Modal` component
2. Move modal visibility to `isOpen` prop
3. Update close handlers to `onClose` prop
4. Map size props appropriately
5. Update footer to use `footer` prop

## Related Components

- [Alert](/?path=/docs/documentation-alert--docs) - For inline messages
- [Button](/?path=/docs/documentation-button--docs) - For modal actions
- [Input](/?path=/docs/documentation-input--docs) - For modal forms
- [Card](/?path=/docs/documentation-card--docs) - For modal content structure

## FAQ

**Q: How do I prevent closing on overlay click?**  
A: Set `closeOnOverlayClick={false}`.

**Q: Can I have multiple modals open?**  
A: Yes, but avoid nesting. Use one at a time when possible.

**Q: How do I handle form validation?**  
A: Validate in the onClose handler and prevent closing if invalid.

**Q: Should modals be controlled or uncontrolled?**  
A: Always controlled with `isOpen` and `onClose` props.